{#form that is called when creating a new booking#}

{% load static %}
{% load widget_tweaks %}
{% load tags %}

{% block stylesheet %}
    <link rel="stylesheet" href="{% static 'css/clockpicker.css' %}">
{% endblock %}

{% block content %}
    {{form.person.as_hidden}}
    {{form.queueNo.as_hidden}}
    <div>
        <h5>Title</h5>
        {{form.title}}
    </div>
    <div class="form-margin">
        <h5>Location </h5>
        {{form.location}}
    </div>
    <div class="form-margin">
        <h5>Description</h5>
        {{form.description}}
    </div>
    <div class="form-margin">
        <h5>Group</h5>
        {{form.group}}
    </div>

    <div class="form-margin">
        <label>Date</label>
        <input type="date" id="date" class="form-control" onclick="minMaxDate()">
        {{ form.start.as_hidden }}
        {{ form.end.as_hidden }}
    </div>
    <div class="form-margin">
        <label>Starttime</label>
        <div class="input-group clockpicker" data-placement="top" data-align="bottom" data-autoclose="true" id="startTime">
            <input type="text" class="form-control" value="Choose start time" id="startInput" onclick="resetClock()" required>
            <span class="input-group-addon" onclick="resetClock()">
            <span class="glyphicon glyphicon-time"></span>
            </span>
        </div>
    </div>
    <div class="form-margin">
        <label>Endtime</label>
        <div class="input-group clockpicker" data-placement="top" data-align="bottom" data-autoclose="true" id="endTime" >
            <input type="text" class="form-control" value="Choose end time" id="endInput" onclick="editClock()" required>
            <span class="input-group-addon" id="endTimeSpan">
            <span class="glyphicon glyphicon-time"></span>
            </span>
        </div>
    </div>
    {% if request.user.is_superuser %}
        <div class="form-margin">
            <h5>Recurring</h5>
            <select class="form-control" id="recurringEvent">
                <option value="noRepeat" id="noRepeat">Does not repeat</option>
                <option value="weekly" id="weekly">Repeat every</option>
            </select>
        </div>
    {% endif %}
    {% if user.is_authenticated and not request.user.is_superuser %}
        {% user_in_hs user as user_in_hs %}
        {% if user_in_hs %}
            <div class="form-margin">
                <h5>Request Recurring</h5>
                <select class="form-control" id="recurringEvent">
                    <option value="noRepeat" id="noRepeat">Does not repeat</option>
                    <option value="weekly" id="weekly">Repeat every</option>
                </select>
            </div>
        {% endif %}
    {% endif %}
{% endblock %}

{% block script %}
<script>
    $(document).ready(function(){
        var $Form = $('#createform');
        $Form.submit(function(event){
            event.preventDefault()
            // append start date to post request
            var start_time = document.getElementById("startInput").value.toString();
            var end_time = document.getElementById("endInput").value.toString();
            var dates = document.getElementById("date").value.toString();
            console.log(dates + start_time)
            var $form_data = $("#createform").serializeArray();
            $form_data.forEach(function (item) {
                if (item.name === 'start') {
                    item.value = dates + " " + start_time;
                }
                if (item.name === 'end') {
                    item.value = dates + " " + end_time;
                }
            });
            console.log($form_data);
            console.log("hallo?");
            var form = $(this);
            $.ajax({
                method: "POST",
                url: '/booking/bookings_list/create/',
                data: $form_data,
                // close popup on success
                success: function(data) {
                    var modal = document.getElementById('booking-modal');
                    modal.style.display = "none";
                    $("#person-booking-table").html(data.html_booking_list);
                    Swal();
                     if ((form.context[3].value)>0) {
                        queuedTab();
                        document.getElementById("booked-tab").className = "tablinks";
                        document.getElementById("queued-tab").className = "tablinks active";
                    }
                    else {
                        bookedTab();
                        document.getElementById("queued-tab").className = "tablinks";
                        document.getElementById("booked-tab").className = "tablinks active";
                    }
                },
            })
        })
    })
</script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script type="text/javascript" src="{% static 'js/popup.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/clockpicker.js' %}"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


{% endblock script %}